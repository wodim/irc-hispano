<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PEAK Library: Garbage collector</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>Garbage collector</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
<dl compact><dt><b></b></dt><dd>In brief: this module adds a feature to delay the destruction of pointers of different sizes, thus allowing the application to reuse some pointers not really deleted yet. See the <code>mem_pool</code> module for another type of allocation optimization feature.</dd></dl>
<dl compact><dt><b></b></dt><dd>A simple garbage collector (with explicit collection) which provides asynchronous deletion. It is probably only useful when an application could avoid to recreate the same objects, when all objects are not of the same size. If it's better for you to just keep them a few seconds or minutes before really delete them, in case you want to reuse them, so this module is probably for you. When it's time to really delete an object, the library calls your callback: if the object has been reused since, just ignore the call... or really delete it otherwise.</dd></dl>
<dl compact><dt><b></b></dt><dd>This module has been created in order to optimize allocations of IRC channels, which are allocated structures of different sizes (different names) and commonly deleted and re-allocated just after (part/join of an empty channel). I am not sure it will suit for something else.</dd></dl>
<dl compact><dt><b></b></dt><dd>Usage is very easy: initialize a garbage collector object with <a class="el" href="group__garbage.html#ga9">peak_garbage_create()</a> providing a generic deletion callback for all collected objects, then call <a class="el" href="group__garbage.html#ga10">peak_garbage_collect()</a> for each object you want to delete using the collector. The objects will be automatically deleted (you shouldn't predict the deletion, as the frequency is only a hint - note it's usually less because all collected objects are always deleted at the same time). If needed, you can force all objects deletion with the <a class="el" href="group__garbage.html#ga12">peak_garbage_vacuum()</a> function. </dd></dl>

<p>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="ga0" doxytag="garbage::peak_garbage" ></a>
typedef __peak_garbage *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__garbage.html#ga0">peak_garbage</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Opaque garbage collector pointer type. <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="ga1" doxytag="garbage::peak_garbage_callback" ></a>
typedef void(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__garbage.html#ga1">peak_garbage_callback</a> )(<a class="el" href="group__garbage.html#ga0">peak_garbage</a> g, void *ptr, void *context)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deletion's callback definition. <br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="group__garbage.html#ga0">peak_garbage</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__garbage.html#ga2">peak_garbage_create</a> (int max_ptrs, double frequency, <a class="el" href="group__task__common.html#ga0">peak_task</a> task, <a class="el" href="group__garbage.html#ga1">peak_garbage_callback</a> callout, void *context)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a garbage object.  <a href="#ga2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__garbage.html#ga3">peak_garbage_collect</a> (<a class="el" href="group__garbage.html#ga0">peak_garbage</a> g, void *ptr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Collect a pointer and schedules the garbage's task for deletion.  <a href="#ga3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__garbage.html#ga4">peak_garbage_get_collected_count</a> (<a class="el" href="group__garbage.html#ga0">peak_garbage</a> g)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the current number of pointers collected for deletion.  <a href="#ga4"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__garbage.html#ga5">peak_garbage_vacuum</a> (<a class="el" href="group__garbage.html#ga0">peak_garbage</a> g)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform manual vacuuming.  <a href="#ga5"></a><br><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga3" doxytag="garbage.h::peak_garbage_collect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void peak_garbage_collect </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__garbage.html#ga0">peak_garbage</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>g</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>ptr</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Collect a pointer and schedules the garbage's task for deletion. 
<p>
Guaranteed O(1) unless <em>max_ptrs</em> is reached.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>g</em>&nbsp;</td><td>The garbage object reference. </td></tr>
    <tr><td valign=top><em>ptr</em>&nbsp;</td><td>Pointer to collect for deletion. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga2" doxytag="garbage.h::peak_garbage_create" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="group__garbage.html#ga0">peak_garbage</a> peak_garbage_create </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>max_ptrs</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>frequency</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="group__task__common.html#ga0">peak_task</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>task</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="group__garbage.html#ga1">peak_garbage_callback</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>callout</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a garbage object. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>max_ptrs</em>&nbsp;</td><td>Max pointers that the garbage object can collect at the same time. Must be strictly positive. If reached, a vacuuming is performed and the object properly collected. </td></tr>
    <tr><td valign=top><em>frequency</em>&nbsp;</td><td>Frequency hint in seconds at which you want to do the vacuuming (deletions), it's usually less because when vacuuming the callback is called for all objects already collected. </td></tr>
    <tr><td valign=top><em>task</em>&nbsp;</td><td>Task to schedule, can be <code>NULL</code> to use current task. </td></tr>
    <tr><td valign=top><em>callout</em>&nbsp;</td><td>A pointer to your deletion callback function which is triggered when automatic of manual vacuuming. </td></tr>
    <tr><td valign=top><em>context</em>&nbsp;</td><td>An extra application-defined pointer that will be passed to your garbage callback function.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>A newly allocated <code>peak_garbage</code> reference or <code>NULL</code> if the object cannot be created. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga4" doxytag="garbage.h::peak_garbage_get_collected_count" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int peak_garbage_get_collected_count </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__garbage.html#ga0">peak_garbage</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>g</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the current number of pointers collected for deletion. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>g</em>&nbsp;</td><td>The garbage object reference.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Collected pointers count. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga5" doxytag="garbage.h::peak_garbage_vacuum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void peak_garbage_vacuum </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__garbage.html#ga0">peak_garbage</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>g</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Perform manual vacuuming. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>g</em>&nbsp;</td><td>The garbage object reference. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat Jan 17 21:41:54 2004 for the PEAK Library by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0" > 
</a></small>&nbsp; &nbsp; <a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=98146&amp;type=1" width="88" height="31" align="middle" border="0" alt="SourceForge.net Logo" /></a></address>
</body>
</html>

